<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="For Arduino User" href="for_arduino_user.html" /><link rel="prev" title="Lesson 19 7-segment" href="lesson_19_7-segment.html" />

    <meta name="generator" content="sphinx-3.5.4, furo 2021.04.11.beta34"/>
        <title>Lesson 20 Traffic Light - SunFounder Electronic Kit 1.0 documentation</title>
      <link rel="stylesheet" href="_static/styles/furo.css?digest=59ab60ac09ea94ccfe6deddff6d715cce948a6fc">
    <link rel="stylesheet" href="_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="_static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" type="text/css" href="https://ezblock.cc/readDocFile/topHead.css" />
    <link rel="stylesheet" href="_static/styles/furo-extensions.css?digest=d391b54134226e4196576da3bdb6dddb7e05ba2b"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">SunFounder Electronic Kit 1.0 documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">SunFounder Electronic Kit 1.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="component_list.html">Component List</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="for_rasberrypi_user.html">For Rasberry Pi User</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="preparation/preparation.html">Preparation</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="preparation/installing_the_os.html">Installing the OS</a></li>
<li class="toctree-l3"><a class="reference internal" href="preparation/set_up_your_raspberry_pi.html">Set up Your Raspberry Pi</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="libraries.html">Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="download_the_code.html">Download the Code</a></li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="lessons.html">Lessons</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="lesson_1_blinking_led.html"><strong>Lesson 1 Blinking LED</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_2_flowing_led_lights.html"><strong>Lesson 2 Flowing LED Lights</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_3_breathing_led.html"><strong>Lesson 3 Breathing LED</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_4_rgb_led.html"><strong>Lesson 4 RGB LED</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_5_controlling_led_by_button.html"><strong>Lesson 5 Controlling LED by Button</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_6_tilt_switch.html"><strong>Lesson 6 Tilt Switch</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_7_slide_switch.html"><strong>Lesson 7 Slide Switch</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_8_relay.html"><strong>Lesson 8 Relay</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_9_4n35.html"><strong>Lesson 9 4N35</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_10_active_buzzer.html"><strong>Lesson 10 Active Buzzer</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_11_doorbell.html"><strong>Lesson 11 Doorbell</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_12_passive_buzzer.html"><strong>Lesson 12 Passive Buzzer</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_13_button_piano.html"><strong>Lesson 13 Button Piano</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_14_quiz_buzzer_system.html"><strong>Lesson 14 Quiz Buzzer System</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_15_ne555_timer.html"><strong>Lesson 15 NE555 Timer</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_16_servo.html"><strong>Lesson 16 Servo</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_17_lcd1602.html"><strong>Lesson 17 LCD1602</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_18_driving_leds_by_74hc595.html"><strong>Lesson 18 Driving LEDs by 74HC595</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_19_7-segment.html"><strong>Lesson 19 7-segment</strong></a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#"><strong>Lesson 20 Traffic Light</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="for_arduino_user.html">For Arduino User</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="lesson_1_install_and_introduce_arduino_ide.html"><strong>Lesson 1 Install and Introduce Arduino IDE</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_2_blinking_led.html"><strong>Lesson 2 Blinking LED</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_3_controlling_led_by_button.html"><strong>Lesson 3 Controlling LED by Button</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_4_controlling_an_led_by_potentiometer.html"><strong>Lesson 4 Controlling an LED by Potentiometer</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_5_doorbell.html"><strong>Lesson 5 Doorbell</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_6_Photoresistor.html"><strong>Lesson 6 Photoresistor</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_7_rgb_led.html"><strong>Lesson 7 RGB LED</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_8_tilt_switch.html"><strong>Lesson 8 Tilt Switch</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_9_slide_switch.html"><strong>Lesson 9 Slide Switch</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_10_relay.html"><strong>Lesson 10 Relay</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_11_4n35.html"><strong>Lesson 11 4N35</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_12_ne555_timer.html"><strong>Lesson 12 NE555 Timer</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_13_servo.html"><strong>Lesson 13 Servo</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_14_lcd1602.html"><strong>Lesson 14 LCD1602</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_15_thermistor.html"><strong>Lesson 15 Thermistor</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_16_voltmeter.html"><strong>Lesson 16 Voltmeter</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_17_automatically_tracking_light_source.html"><strong>Lesson 17 Automatically Tracking Light Source</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_18_light_alarm.html"><strong>Lesson 18 Light Alarm</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_19_answer_machine.html"><strong>Lesson 19 Answer Machine</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_20_controlling_voice_by_light.html"><strong>Lesson 20 Controlling Voice by Light</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_21_74HC595.html"><strong>Lesson 21 74HC595</strong></a></li>
</ul>
</li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div class="section" id="lesson-20-traffic-light">
<h1><strong>Lesson 20 Traffic Light</strong><a class="headerlink" href="#lesson-20-traffic-light" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2><strong>Introduction</strong><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>In last lesson, we learned how to use a 74HC595 chip to drive
a 7-Segment Display. Based on that, we can apply it more widely
now, such as making a simple traffic light. Now let’s get started!</p>
</div>
<div class="section" id="newly-added-components">
<h2><strong>Newly Added Components</strong><a class="headerlink" href="#newly-added-components" title="Permalink to this headline">¶</a></h2>
<a class="reference internal image-reference" href="_images/image251.png"><img alt="_images/image251.png" class="align-center" src="_images/image251.png" style="width: 800px;"/></a>
</div>
<div class="section" id="schematic-diagram">
<h2><strong>Schematic Diagram</strong><a class="headerlink" href="#schematic-diagram" title="Permalink to this headline">¶</a></h2>
<a class="reference internal image-reference" href="_images/image252.png"><img alt="_images/image252.png" class="align-center" src="_images/image252.png" style="width: 800px;"/></a>
<a class="reference internal image-reference" href="_images/image261.png"><img alt="_images/image261.png" class="align-center" src="_images/image261.png" style="width: 800px;"/></a>
</div>
<div class="section" id="build-the-circuit">
<h2><strong>Build the Circuit</strong><a class="headerlink" href="#build-the-circuit" title="Permalink to this headline">¶</a></h2>
<a class="reference internal image-reference" href="_images/image253.png"><img alt="_images/image253.png" class="align-center" src="_images/image253.png" style="width: 800px;"/></a>
</div>
<div class="section" id="for-c-language-users">
<h2><strong>For C Language Users</strong><a class="headerlink" href="#for-c-language-users" title="Permalink to this headline">¶</a></h2>
<div class="section" id="command">
<h3><strong>Command</strong><a class="headerlink" href="#command" title="Permalink to this headline">¶</a></h3>
<p><strong>1.</strong> Go to the folder of the code.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">pi</span><span class="o">/</span><span class="n">electronic</span><span class="o">-</span><span class="n">kit</span><span class="o">/</span><span class="k">for</span><span class="o">-</span><span class="n">raspberry</span><span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Lesson_20_TrafficLight</span>
</pre></div>
</div>
<p><strong>2.</strong> Compile the code.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gcc</span> <span class="mi">20</span><span class="n">_TrafficLight</span><span class="o">.</span><span class="n">c</span> <span class="o">-</span><span class="n">lwiringPi</span>
</pre></div>
</div>
<p><strong>3.</strong> Run the executable file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">./</span><span class="n">a</span><span class="o">.</span><span class="n">out</span>
</pre></div>
</div>
<p>You can see the following phenomenon of traffic lights. The red LED
lights up for 9 seconds, green LED for 5s, and yellow LED for 3s.</p>
</div>
<div class="section" id="code">
<h3><strong>Code</strong><a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span><span class="c1">#include &lt;wiringPi.h&gt;</span>
<span class="mf">2.</span><span class="c1">#include &lt;stdio.h&gt;</span>
<span class="mf">3.</span><span class="c1">#include &lt;wiringShift.h&gt;</span>
<span class="mf">4.</span><span class="c1">#include &lt;signal.h&gt;</span>
<span class="mf">5.</span><span class="c1">#include &lt;unistd.h&gt;</span>
<span class="mf">6.</span><span class="c1">#define     SDI     0   //serial data input(DS)</span>
<span class="mf">7.</span><span class="c1">#define     RCLK    1   //memory clock input(STCP)</span>
<span class="mf">8.</span><span class="c1">#define     SRCLK    2    //shift register clock input(SHCP)</span>
<span class="mf">9.</span><span class="n">const</span> <span class="nb">int</span> <span class="n">ledPin</span><span class="p">[]</span><span class="o">=</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">};</span>   <span class="o">//</span><span class="n">Define</span> <span class="mi">3</span> <span class="n">LED</span> <span class="n">pin</span><span class="p">(</span><span class="n">Red</span><span class="p">,</span> <span class="n">Green</span><span class="p">,</span> <span class="n">Yellow</span><span class="p">)</span>
<span class="mf">10.</span><span class="n">unsigned</span> <span class="n">char</span> <span class="n">SegCode</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x3f</span><span class="p">,</span><span class="mh">0x06</span><span class="p">,</span><span class="mh">0x5b</span><span class="p">,</span><span class="mh">0x4f</span><span class="p">,</span><span class="mh">0x66</span><span class="p">,</span><span class="mh">0x6d</span><span class="p">,</span><span class="mh">0x7d</span><span class="p">,</span><span class="mh">0x07</span><span class="p">,</span><span class="mh">0x7f</span><span class="p">,</span><span class="mh">0x6f</span><span class="p">,</span><span class="mh">0x77</span><span class="p">,</span><span class="mh">0x7c</span><span class="p">,</span><span class="mh">0x39</span><span class="p">,</span><span class="mh">0x5e</span><span class="p">,</span><span class="mh">0x79</span><span class="p">,</span><span class="mh">0x71</span><span class="p">,</span><span class="mh">0x80</span><span class="p">};</span>
<span class="mf">11.</span>
<span class="mf">12.</span><span class="n">int</span> <span class="n">greentime</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="mf">13.</span><span class="n">int</span> <span class="n">yellowtime</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="mf">14.</span><span class="n">int</span> <span class="n">redtime</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
<span class="mf">15.</span><span class="n">int</span> <span class="n">colorState</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="mf">16.</span><span class="n">char</span> <span class="o">*</span><span class="n">lightColor</span><span class="p">[]</span><span class="o">=</span><span class="p">{</span><span class="s2">"Red"</span><span class="p">,</span><span class="s2">"Green"</span><span class="p">,</span><span class="s2">"Yellow"</span><span class="p">};</span>
<span class="mf">17.</span><span class="n">int</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
<span class="mf">18.</span>
<span class="mf">19.</span><span class="n">void</span> <span class="n">init</span><span class="p">(</span><span class="n">void</span><span class="p">){</span>
<span class="mf">20.</span>    <span class="n">pinMode</span><span class="p">(</span><span class="n">SDI</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="mf">21.</span>    <span class="n">pinMode</span><span class="p">(</span><span class="n">RCLK</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="mf">22.</span>    <span class="n">pinMode</span><span class="p">(</span><span class="n">SRCLK</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="mf">23.</span>
<span class="mf">24.</span>    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SDI</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="mf">25.</span>    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">RCLK</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="mf">26.</span>    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SRCLK</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="mf">27.</span>
<span class="mf">28.</span>      <span class="k">for</span><span class="p">(</span><span class="nb">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="mf">29.</span>        <span class="n">pinMode</span><span class="p">(</span><span class="n">ledPin</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">OUTPUT</span><span class="p">);</span>
<span class="mf">30.</span>        <span class="n">digitalWrite</span><span class="p">(</span><span class="n">ledPin</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">LOW</span><span class="p">);</span>
<span class="mf">31.</span>    <span class="p">}</span>
<span class="mf">32.</span><span class="p">}</span>
<span class="mf">33.</span>
<span class="mf">34.</span><span class="n">void</span> <span class="n">hc595_shift</span><span class="p">(</span><span class="n">unsigned</span> <span class="n">char</span> <span class="n">dat</span><span class="p">){</span>
<span class="mf">35.</span>    <span class="nb">int</span> <span class="n">i</span><span class="p">;</span>
<span class="mf">36.</span>    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">8</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="mf">37.</span>        <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SDI</span><span class="p">,</span> <span class="mh">0x80</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dat</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">));</span>
<span class="mf">38.</span>        <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SRCLK</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="mf">39.</span>        <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="mf">40.</span>        <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SRCLK</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="mf">41.</span>    <span class="p">}</span>
<span class="mf">42.</span>        <span class="n">digitalWrite</span><span class="p">(</span><span class="n">RCLK</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="mf">43.</span>        <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="mf">44.</span>        <span class="n">digitalWrite</span><span class="p">(</span><span class="n">RCLK</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="mf">45.</span><span class="p">}</span>
<span class="mf">46.</span>
<span class="mf">47.</span><span class="n">void</span> <span class="n">timer</span><span class="p">(</span><span class="nb">int</span>  <span class="n">sig</span><span class="p">){</span>       <span class="o">//</span><span class="n">Timer</span> <span class="n">function</span>
<span class="mf">48.</span>    <span class="k">if</span><span class="p">(</span><span class="n">sig</span> <span class="o">==</span> <span class="n">SIGALRM</span><span class="p">){</span>
<span class="mf">49.</span>        <span class="n">counter</span> <span class="o">--</span><span class="p">;</span>
<span class="mf">50.</span>        <span class="n">alarm</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="mf">51.</span>        <span class="k">if</span><span class="p">(</span><span class="n">counter</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
<span class="mf">52.</span>            <span class="k">if</span><span class="p">(</span><span class="n">colorState</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">greentime</span><span class="p">;</span>
<span class="mf">53.</span>            <span class="k">if</span><span class="p">(</span><span class="n">colorState</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">yellowtime</span><span class="p">;</span>
<span class="mf">54.</span>            <span class="k">if</span><span class="p">(</span><span class="n">colorState</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">redtime</span><span class="p">;</span>
<span class="mf">55.</span>            <span class="n">colorState</span> <span class="o">=</span> <span class="p">(</span><span class="n">colorState</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span><span class="p">;</span>
<span class="mf">56.</span>        <span class="p">}</span>
<span class="mf">57.</span>        <span class="n">printf</span><span class="p">(</span><span class="s2">"counter : </span><span class="si">%d</span><span class="s2"> </span><span class="se">\t</span><span class="s2"> light color: </span><span class="si">%s</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span><span class="n">counter</span><span class="p">,</span><span class="n">lightColor</span><span class="p">[</span><span class="n">colorState</span><span class="p">]);</span>
<span class="mf">58.</span>    <span class="p">}</span>
<span class="mf">59.</span><span class="p">}</span>
<span class="mf">60.</span>
<span class="mf">61.</span><span class="n">void</span> <span class="n">display</span><span class="p">(</span><span class="nb">int</span> <span class="n">num</span><span class="p">)</span>
<span class="mf">62.</span><span class="p">{</span>
<span class="mf">63.</span>    <span class="n">hc595_shift</span><span class="p">(</span><span class="n">SegCode</span><span class="p">[</span><span class="n">num</span><span class="o">%</span><span class="mi">10</span><span class="p">]);</span>
<span class="mf">64.</span>    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="mf">65.</span><span class="p">}</span>
<span class="mf">66.</span>
<span class="mf">67.</span><span class="n">void</span> <span class="n">lightup</span><span class="p">(</span><span class="nb">int</span> <span class="n">state</span><span class="p">)</span>
<span class="mf">68.</span><span class="p">{</span>
<span class="mf">69.</span>    <span class="k">for</span><span class="p">(</span><span class="nb">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="mf">70.</span>        <span class="n">digitalWrite</span><span class="p">(</span><span class="n">ledPin</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">LOW</span><span class="p">);</span>
<span class="mf">71.</span>    <span class="p">}</span>
<span class="mf">72.</span>        <span class="n">digitalWrite</span><span class="p">(</span><span class="n">ledPin</span><span class="p">[</span><span class="n">state</span><span class="p">],</span><span class="n">HIGH</span><span class="p">);</span>
<span class="mf">73.</span><span class="p">}</span>
<span class="mf">74.</span>
<span class="mf">75.</span><span class="n">int</span> <span class="n">main</span><span class="p">(</span><span class="n">void</span><span class="p">)</span>
<span class="mf">76.</span><span class="p">{</span>
<span class="mf">77.</span>    <span class="nb">int</span> <span class="n">i</span><span class="p">;</span>
<span class="mf">78.</span>
<span class="mf">79.</span>    <span class="k">if</span><span class="p">(</span><span class="n">wiringPiSetup</span><span class="p">()</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">){</span> <span class="o">//</span><span class="n">when</span> <span class="n">initialize</span> <span class="n">wiring</span> <span class="n">failed</span><span class="p">,</span><span class="nb">print</span> <span class="n">message</span> <span class="n">to</span> <span class="n">screen</span>
<span class="mf">80.</span>        <span class="n">printf</span><span class="p">(</span><span class="s2">"setup wiringPi failed !"</span><span class="p">);</span>
<span class="mf">81.</span>        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="mf">82.</span>    <span class="p">}</span>
<span class="mf">83.</span>
<span class="mf">84.</span>    <span class="n">init</span><span class="p">();</span>
<span class="mf">85.</span>
<span class="mf">86.</span>    <span class="n">signal</span><span class="p">(</span><span class="n">SIGALRM</span><span class="p">,</span><span class="n">timer</span><span class="p">);</span>  <span class="o">//</span><span class="n">configure</span> <span class="n">the</span> <span class="n">timer</span>
<span class="mf">87.</span>    <span class="n">alarm</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>               <span class="o">//</span><span class="nb">set</span> <span class="n">the</span> <span class="n">time</span> <span class="n">of</span> <span class="n">timer</span> <span class="n">to</span> <span class="mi">1</span><span class="n">s</span>
<span class="mf">88.</span>    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){</span>
<span class="mf">89.</span>
<span class="mf">90.</span>            <span class="n">display</span><span class="p">(</span><span class="n">counter</span><span class="p">);</span>
<span class="mf">91.</span>        <span class="n">lightup</span><span class="p">(</span><span class="n">colorState</span><span class="p">);</span>
<span class="mf">92.</span>         <span class="p">}</span>
<span class="mf">93.</span>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="mf">94.</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="code-explanation">
<h3><strong>Code Explanation</strong><a class="headerlink" href="#code-explanation" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">12.</span><span class="n">int</span> <span class="n">greentime</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="mf">13.</span><span class="n">int</span> <span class="n">yellowtime</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="mf">14.</span><span class="n">int</span> <span class="n">redtime</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
</pre></div>
</div>
<p>Define the duration of lighting of three LEDs. Since
what we use is a 7-Segment Display here, we shorten
the length of seconds of lighting of traffic lights,
setting the green LED to light up for 5 seconds, the
yellow LED to 3 seconds, and the red LED to 9 seconds.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">15.</span><span class="n">int</span> <span class="n">colorState</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="mf">16.</span><span class="n">int</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
</pre></div>
</div>
<p>The variable colorState corresponds to the state of
the traffic lights, and we only need to do a simple
calculation of colorState to indicate the order change
of the state of the traffic lights. The Variable counter
is used to count down the time to each traffic light
status and will be output on a 7-Segment Display.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">19.</span><span class="n">void</span> <span class="n">init</span><span class="p">(</span><span class="n">void</span><span class="p">){</span>
<span class="mf">20.</span>    <span class="n">pinMode</span><span class="p">(</span><span class="n">SDI</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="mf">21.</span>    <span class="n">pinMode</span><span class="p">(</span><span class="n">RCLK</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="mf">22.</span>    <span class="n">pinMode</span><span class="p">(</span><span class="n">SRCLK</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="mf">23.</span>
<span class="mf">24.</span>    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SDI</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="mf">25.</span>    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">RCLK</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="mf">26.</span>    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SRCLK</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="mf">27.</span>
<span class="mf">28.</span>      <span class="k">for</span><span class="p">(</span><span class="nb">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="mf">29.</span>        <span class="n">pinMode</span><span class="p">(</span><span class="n">ledPin</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">OUTPUT</span><span class="p">);</span>
<span class="mf">30.</span>        <span class="n">digitalWrite</span><span class="p">(</span><span class="n">ledPin</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">LOW</span><span class="p">);</span>
<span class="mf">31.</span>    <span class="p">}</span>
<span class="mf">32.</span><span class="p">}</span>
</pre></div>
</div>
<p>Initialize pins. Set all control pins of 74HC595 to output
mode and initialize them to low level. At the same time,
the LEDs are set to output mode, default low level.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">47.</span><span class="n">void</span> <span class="n">timer</span><span class="p">(</span><span class="nb">int</span>  <span class="n">sig</span><span class="p">){</span>
<span class="mf">48.</span>    <span class="k">if</span><span class="p">(</span><span class="n">sig</span> <span class="o">==</span> <span class="n">SIGALRM</span><span class="p">){</span>
<span class="mf">49.</span>        <span class="n">counter</span> <span class="o">--</span><span class="p">;</span>
<span class="mf">50.</span>        <span class="n">alarm</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="mf">51.</span>        <span class="k">if</span><span class="p">(</span><span class="n">counter</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
<span class="mf">52.</span>            <span class="k">if</span><span class="p">(</span><span class="n">colorState</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">greentime</span><span class="p">;</span>
<span class="mf">53.</span>            <span class="k">if</span><span class="p">(</span><span class="n">colorState</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">yellowtime</span><span class="p">;</span>
<span class="mf">54.</span>            <span class="k">if</span><span class="p">(</span><span class="n">colorState</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">redtime</span><span class="p">;</span>
<span class="mf">55.</span>            <span class="n">colorState</span> <span class="o">=</span> <span class="p">(</span><span class="n">colorState</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span><span class="p">;</span>
<span class="mf">56.</span>        <span class="p">}</span>
<span class="mf">57.</span>        <span class="n">printf</span><span class="p">(</span><span class="s2">"counter : </span><span class="si">%d</span><span class="s2"> </span><span class="se">\t</span><span class="s2"> light color: </span><span class="si">%s</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span><span class="n">counter</span><span class="p">,</span><span class="n">lightColor</span><span class="p">[</span><span class="n">colorState</span><span class="p">]);</span>
<span class="mf">58.</span>    <span class="p">}</span>
<span class="mf">59.</span><span class="p">}</span>
</pre></div>
</div>
<p>On this timer, counter decreases gradually with every second passing,
and when it goes to 0, the state of the traffic light changes accordingly.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">67.</span><span class="n">void</span> <span class="n">lightup</span><span class="p">(</span><span class="nb">int</span> <span class="n">state</span><span class="p">)</span>
<span class="mf">68.</span><span class="p">{</span>
<span class="mf">69.</span>    <span class="k">for</span><span class="p">(</span><span class="nb">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="mf">70.</span>        <span class="n">digitalWrite</span><span class="p">(</span><span class="n">ledPin</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">LOW</span><span class="p">);</span>
<span class="mf">71.</span>    <span class="p">}</span>
<span class="mf">72.</span>        <span class="n">digitalWrite</span><span class="p">(</span><span class="n">ledPin</span><span class="p">[</span><span class="n">state</span><span class="p">],</span><span class="n">HIGH</span><span class="p">);</span>
<span class="mf">73.</span><span class="p">}</span>
</pre></div>
</div>
<p>The function is to turn off all the lights first, and then light
up the corresponding LED according to the value of the traffic light state.</p>
</div>
</div>
<div class="section" id="for-python-language-users">
<h2><strong>For Python Language Users</strong><a class="headerlink" href="#for-python-language-users" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3><strong>Command</strong><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p><strong>1.</strong> Go to the folder of the code.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">pi</span><span class="o">/</span><span class="n">electronic</span><span class="o">-</span><span class="n">kit</span><span class="o">/</span><span class="k">for</span><span class="o">-</span><span class="n">raspberry</span><span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="n">python</span>
</pre></div>
</div>
<p><strong>2.</strong> Run the code.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">python3</span> <span class="mi">20</span><span class="n">_TrafficLight</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>You can see the following phenomenon of traffic lights. The red LED
lights up for 9 seconds, green LED for 5s, and yellow LED for 3s.</p>
</div>
<div class="section" id="id2">
<h3><strong>Code</strong><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span><span class="kn">import</span> <span class="nn">RPi.GPIO</span> <span class="k">as</span> <span class="nn">GPIO</span>
<span class="mf">2.</span><span class="kn">import</span> <span class="nn">time</span>
<span class="mf">3.</span><span class="kn">import</span> <span class="nn">threading</span>
<span class="mf">4.</span>
<span class="mf">5.</span><span class="c1">#define the pins connect to 74HC595</span>
<span class="mf">6.</span><span class="n">SDI</span>   <span class="o">=</span> <span class="mi">17</span>      <span class="c1">#serial data input(DS)</span>
<span class="mf">7.</span><span class="n">RCLK</span>  <span class="o">=</span> <span class="mi">18</span>      <span class="c1">#memory clock input(STCP)</span>
<span class="mf">8.</span><span class="n">SRCLK</span> <span class="o">=</span> <span class="mi">27</span>       <span class="c1">#shift register clock input(SHCP)</span>
<span class="mf">9.</span><span class="n">number</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0x3f</span><span class="p">,</span><span class="mh">0x06</span><span class="p">,</span><span class="mh">0x5b</span><span class="p">,</span><span class="mh">0x4f</span><span class="p">,</span><span class="mh">0x66</span><span class="p">,</span><span class="mh">0x6d</span><span class="p">,</span><span class="mh">0x7d</span><span class="p">,</span><span class="mh">0x07</span><span class="p">,</span><span class="mh">0x7f</span><span class="p">,</span><span class="mh">0x6f</span><span class="p">,</span><span class="mh">0x77</span><span class="p">,</span><span class="mh">0x7c</span><span class="p">,</span><span class="mh">0x39</span><span class="p">,</span><span class="mh">0x5e</span><span class="p">,</span><span class="mh">0x79</span><span class="p">,</span><span class="mh">0x71</span><span class="p">,</span><span class="mh">0x80</span><span class="p">)</span>
<span class="mf">10.</span>
<span class="mf">11.</span><span class="n">ledPin</span> <span class="o">=</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">24</span><span class="p">)</span>
<span class="mf">12.</span>
<span class="mf">13.</span><span class="n">greenLight</span> <span class="o">=</span> <span class="mi">5</span>
<span class="mf">14.</span><span class="n">yellowLight</span> <span class="o">=</span> <span class="mi">3</span>
<span class="mf">15.</span><span class="n">redLight</span> <span class="o">=</span> <span class="mi">9</span>
<span class="mf">16.</span><span class="n">lightColor</span><span class="o">=</span><span class="p">(</span><span class="s2">"Red"</span><span class="p">,</span><span class="s2">"Green"</span><span class="p">,</span><span class="s2">"Yellow"</span><span class="p">)</span>
<span class="mf">17.</span>
<span class="mf">18.</span><span class="n">colorState</span><span class="o">=</span><span class="mi">0</span>
<span class="mf">19.</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">9</span>
<span class="mf">20.</span><span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
<span class="mf">21.</span>
<span class="mf">22.</span><span class="k">def</span> <span class="nf">setup</span><span class="p">():</span>
<span class="mf">23.</span>    <span class="n">GPIO</span><span class="o">.</span><span class="n">setmode</span><span class="p">(</span><span class="n">GPIO</span><span class="o">.</span><span class="n">BCM</span><span class="p">)</span>
<span class="mf">24.</span>    <span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">SDI</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span>
<span class="mf">25.</span>    <span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">RCLK</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span>
<span class="mf">26.</span>    <span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">SRCLK</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span>
<span class="mf">27.</span>    <span class="k">for</span> <span class="n">pin</span> <span class="ow">in</span> <span class="n">ledPin</span><span class="p">:</span>
<span class="mf">28.</span>        <span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span><span class="n">GPIO</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span>
<span class="mf">29.</span>
<span class="mf">30.</span>
<span class="mf">31.</span><span class="k">def</span> <span class="nf">hc595_shift</span><span class="p">(</span><span class="n">dat</span><span class="p">):</span>
<span class="mf">32.</span>    <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
<span class="mf">33.</span>        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">SDI</span><span class="p">,</span> <span class="mh">0x80</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dat</span> <span class="o">&lt;&lt;</span> <span class="n">bit</span><span class="p">))</span>
<span class="mf">34.</span>        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">SRCLK</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>
<span class="mf">35.</span>        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">SRCLK</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">LOW</span><span class="p">)</span>
<span class="mf">36.</span>    <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">RCLK</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>
<span class="mf">37.</span>    <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">RCLK</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">LOW</span><span class="p">)</span>
<span class="mf">38.</span>
<span class="mf">39.</span><span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
<span class="mf">40.</span>    <span class="n">hc595_shift</span><span class="p">(</span><span class="mh">0xff</span><span class="p">)</span>
<span class="mf">41.</span>    <span class="n">hc595_shift</span><span class="p">(</span><span class="n">number</span><span class="p">[</span><span class="n">num</span><span class="o">%</span><span class="mi">10</span><span class="p">])</span>
<span class="mf">42.</span>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.003</span><span class="p">)</span>
<span class="mf">43.</span>
<span class="mf">44.</span>
<span class="mf">45.</span><span class="k">def</span> <span class="nf">timer</span><span class="p">():</span>        <span class="c1">#timer function</span>
<span class="mf">46.</span>    <span class="k">global</span> <span class="n">counter</span>
<span class="mf">47.</span>    <span class="k">global</span> <span class="n">colorState</span>
<span class="mf">48.</span>    <span class="k">global</span> <span class="n">t</span>
<span class="mf">49.</span>    <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="n">timer</span><span class="p">)</span>
<span class="mf">50.</span>    <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="mf">51.</span>    <span class="n">counter</span><span class="o">-=</span><span class="mi">1</span>
<span class="mf">52.</span>    <span class="k">if</span> <span class="p">(</span><span class="n">counter</span> <span class="ow">is</span> <span class="mi">0</span><span class="p">):</span>
<span class="mf">53.</span>        <span class="k">if</span><span class="p">(</span><span class="n">colorState</span> <span class="ow">is</span> <span class="mi">0</span><span class="p">):</span>
<span class="mf">54.</span>            <span class="n">counter</span><span class="o">=</span> <span class="n">greenLight</span>
<span class="mf">55.</span>        <span class="k">if</span><span class="p">(</span><span class="n">colorState</span> <span class="ow">is</span> <span class="mi">1</span><span class="p">):</span>
<span class="mf">56.</span>            <span class="n">counter</span><span class="o">=</span><span class="n">yellowLight</span>
<span class="mf">57.</span>        <span class="k">if</span> <span class="p">(</span><span class="n">colorState</span> <span class="ow">is</span> <span class="mi">2</span><span class="p">):</span>
<span class="mf">58.</span>            <span class="n">counter</span><span class="o">=</span><span class="n">redLight</span>
<span class="mf">59.</span>        <span class="n">colorState</span><span class="o">=</span><span class="p">(</span><span class="n">colorState</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span>
<span class="mf">60.</span>    <span class="nb">print</span> <span class="p">(</span><span class="s2">"counter : </span><span class="si">%d</span><span class="s2">    color: </span><span class="si">%s</span><span class="s2"> "</span><span class="o">%</span><span class="p">(</span><span class="n">counter</span><span class="p">,</span><span class="n">lightColor</span><span class="p">[</span><span class="n">colorState</span><span class="p">]))</span>
<span class="mf">61.</span>
<span class="mf">62.</span><span class="k">def</span> <span class="nf">lightup</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
<span class="mf">63.</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
<span class="mf">64.</span>        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">ledPin</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">LOW</span><span class="p">)</span>
<span class="mf">65.</span>    <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">ledPin</span><span class="p">[</span><span class="n">state</span><span class="p">],</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>
<span class="mf">66.</span>
<span class="mf">67.</span><span class="k">def</span> <span class="nf">loop</span><span class="p">():</span>
<span class="mf">68.</span>    <span class="k">global</span> <span class="n">t</span>
<span class="mf">69.</span>    <span class="k">global</span> <span class="n">counter</span>
<span class="mf">70.</span>    <span class="k">global</span> <span class="n">colorState</span>
<span class="mf">71.</span>    <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="n">timer</span><span class="p">)</span>
<span class="mf">72.</span>    <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="mf">73.</span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="mf">74.</span>        <span class="n">display</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
<span class="mf">75.</span>        <span class="n">lightup</span><span class="p">(</span><span class="n">colorState</span><span class="p">)</span>
<span class="mf">76.</span>
<span class="mf">77.</span><span class="k">def</span> <span class="nf">destroy</span><span class="p">():</span>   <span class="c1"># When "Ctrl+C" is pressed, the function is executed.</span>
<span class="mf">78.</span>    <span class="k">global</span> <span class="n">t</span>
<span class="mf">79.</span>    <span class="n">GPIO</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
<span class="mf">80.</span>    <span class="n">t</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>      <span class="c1">#cancel the timer</span>
<span class="mf">81.</span>
<span class="mf">82.</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span> <span class="c1"># Program starting from here</span>
<span class="mf">83.</span>    <span class="n">setup</span><span class="p">()</span>
<span class="mf">84.</span>    <span class="k">try</span><span class="p">:</span>
<span class="mf">85.</span>        <span class="n">loop</span><span class="p">()</span>
<span class="mf">86.</span>    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
<span class="mf">87.</span>        <span class="n">destroy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3><strong>Code Explanation</strong><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">13.</span><span class="n">greenLight</span> <span class="o">=</span> <span class="mi">5</span>
<span class="mf">14.</span><span class="n">yellowLight</span> <span class="o">=</span> <span class="mi">3</span>
<span class="mf">15.</span><span class="n">redLight</span> <span class="o">=</span> <span class="mi">9</span>
</pre></div>
</div>
<p>Define the duration of lighting of three LEDs.
Since what we use is a 7-Segment Display here,
we shorten the length of seconds of lighting of
traffic LEDs, setting the green LED to light up for
5 seconds, the yellow LED to 3 seconds, and the red
LED to 9 seconds.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">18.</span><span class="n">colorState</span><span class="o">=</span><span class="mi">0</span>
<span class="mf">19.</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">9</span>
</pre></div>
</div>
<p>The variable colorState corresponds to the state of the traffic LEDs,
and we only need to do a simple calculation of colorState to indicate
the order change of the state of the traffic LEDs.
counter is used to count down the time to each traffic LED status
and will be output on a 7-Segment Display.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">45.</span><span class="k">def</span> <span class="nf">timer</span><span class="p">():</span>        <span class="c1">#timer function</span>
<span class="mf">46.</span>    <span class="k">global</span> <span class="n">counter</span>
<span class="mf">47.</span>    <span class="k">global</span> <span class="n">colorState</span>
<span class="mf">48.</span>    <span class="k">global</span> <span class="n">t</span>
<span class="mf">49.</span>    <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="n">timer</span><span class="p">)</span>
<span class="mf">50.</span>    <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="mf">51.</span>    <span class="n">counter</span><span class="o">-=</span><span class="mi">1</span>
<span class="mf">52.</span>    <span class="k">if</span> <span class="p">(</span><span class="n">counter</span> <span class="ow">is</span> <span class="mi">0</span><span class="p">):</span>
<span class="mf">53.</span>        <span class="k">if</span><span class="p">(</span><span class="n">colorState</span> <span class="ow">is</span> <span class="mi">0</span><span class="p">):</span>
<span class="mf">54.</span>            <span class="n">counter</span><span class="o">=</span> <span class="n">greenLight</span>
<span class="mf">55.</span>        <span class="k">if</span><span class="p">(</span><span class="n">colorState</span> <span class="ow">is</span> <span class="mi">1</span><span class="p">):</span>
<span class="mf">56.</span>            <span class="n">counter</span><span class="o">=</span><span class="n">yellowLight</span>
<span class="mf">57.</span>        <span class="k">if</span> <span class="p">(</span><span class="n">colorState</span> <span class="ow">is</span> <span class="mi">2</span><span class="p">):</span>
<span class="mf">58.</span>            <span class="n">counter</span><span class="o">=</span><span class="n">redLight</span>
<span class="mf">59.</span>        <span class="n">colorState</span><span class="o">=</span><span class="p">(</span><span class="n">colorState</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span>
<span class="mf">60.</span>    <span class="nb">print</span> <span class="p">(</span><span class="s2">"counter : </span><span class="si">%d</span><span class="s2">    color: </span><span class="si">%s</span><span class="s2"> "</span><span class="o">%</span><span class="p">(</span><span class="n">counter</span><span class="p">,</span><span class="n">lightColor</span><span class="p">[</span><span class="n">colorState</span><span class="p">]))</span>
</pre></div>
</div>
<p>On this timer, counter decreases gradually with every second passing,
and when it goes to 0, the state of the traffic LED changes accordingly.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">62.</span><span class="k">def</span> <span class="nf">lightup</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
<span class="mf">63.</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
<span class="mf">64.</span>        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">ledPin</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">LOW</span><span class="p">)</span>
<span class="mf">65.</span>    <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">ledPin</span><span class="p">[</span><span class="n">state</span><span class="p">],</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>
</pre></div>
</div>
<p>The function is to turn off all the LEDs first, and then
light up the corresponding LED according to the value of the
traffic LED state.</p>
</div>
</div>
<div class="section" id="phenomenon-picture">
<h2><strong>Phenomenon Picture</strong><a class="headerlink" href="#phenomenon-picture" title="Permalink to this headline">¶</a></h2>
<a class="reference internal image-reference" href="_images/image192.jpeg"><img alt="_images/image192.jpeg" class="align-center" src="_images/image192.jpeg" style="width: 600px;"/></a>
</div>
</div>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="for_arduino_user.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">For Arduino User</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="lesson_19_7-segment.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title"><strong>Lesson 19 7-segment</strong></div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2021, sunfounder
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="_sources/lesson_20_traffic_Light.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#"><strong>Lesson 20 Traffic Light</strong></a><ul>
<li><a class="reference internal" href="#introduction"><strong>Introduction</strong></a></li>
<li><a class="reference internal" href="#newly-added-components"><strong>Newly Added Components</strong></a></li>
<li><a class="reference internal" href="#schematic-diagram"><strong>Schematic Diagram</strong></a></li>
<li><a class="reference internal" href="#build-the-circuit"><strong>Build the Circuit</strong></a></li>
<li><a class="reference internal" href="#for-c-language-users"><strong>For C Language Users</strong></a><ul>
<li><a class="reference internal" href="#command"><strong>Command</strong></a></li>
<li><a class="reference internal" href="#code"><strong>Code</strong></a></li>
<li><a class="reference internal" href="#code-explanation"><strong>Code Explanation</strong></a></li>
</ul>
</li>
<li><a class="reference internal" href="#for-python-language-users"><strong>For Python Language Users</strong></a><ul>
<li><a class="reference internal" href="#id1"><strong>Command</strong></a></li>
<li><a class="reference internal" href="#id2"><strong>Code</strong></a></li>
<li><a class="reference internal" href="#id3"><strong>Code Explanation</strong></a></li>
</ul>
</li>
<li><a class="reference internal" href="#phenomenon-picture"><strong>Phenomenon Picture</strong></a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div>
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="https://ezblock.cc/readDocFile/topHead.js"></script>
    <script src="_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>