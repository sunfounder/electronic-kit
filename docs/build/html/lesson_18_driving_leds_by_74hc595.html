<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Lesson 19 7-segment" href="lesson_19_7-segment.html" /><link rel="prev" title="Lesson 17 LCD1602" href="lesson_17_lcd1602.html" />

    <meta name="generator" content="sphinx-3.5.4, furo 2021.04.11.beta34"/>
        <title>Lesson 18 Driving LEDs by 74HC595 - SunFounder Electronic Kit 1.0 documentation</title>
      <link rel="stylesheet" href="_static/styles/furo.css?digest=59ab60ac09ea94ccfe6deddff6d715cce948a6fc">
    <link rel="stylesheet" href="_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="_static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" type="text/css" href="https://ezblock.cc/readDocFile/topHead.css" />
    <link rel="stylesheet" href="_static/styles/furo-extensions.css?digest=d391b54134226e4196576da3bdb6dddb7e05ba2b"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">SunFounder Electronic Kit 1.0 documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">SunFounder Electronic Kit 1.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="component_list.html">Component List</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="for_rasberrypi_user.html">For Rasberry Pi User</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="preparation/preparation.html">Preparation</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="preparation/installing_the_os.html">Installing the OS</a></li>
<li class="toctree-l3"><a class="reference internal" href="preparation/set_up_your_raspberry_pi.html">Set up Your Raspberry Pi</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="libraries.html">Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="download_the_code.html">Download the Code</a></li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="lessons.html">Lessons</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="lesson_1_blinking_led.html"><strong>Lesson 1 Blinking LED</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_2_flowing_led_lights.html"><strong>Lesson 2 Flowing LED Lights</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_3_breathing_led.html"><strong>Lesson 3 Breathing LED</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_4_rgb_led.html"><strong>Lesson 4 RGB LED</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_5_controlling_led_by_button.html"><strong>Lesson 5 Controlling LED by Button</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_6_tilt_switch.html"><strong>Lesson 6 Tilt Switch</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_7_slide_switch.html"><strong>Lesson 7 Slide Switch</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_8_relay.html"><strong>Lesson 8 Relay</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_9_4n35.html"><strong>Lesson 9 4N35</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_10_active_buzzer.html"><strong>Lesson 10 Active Buzzer</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_11_doorbell.html"><strong>Lesson 11 Doorbell</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_12_passive_buzzer.html"><strong>Lesson 12 Passive Buzzer</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_13_button_piano.html"><strong>Lesson 13 Button Piano</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_14_quiz_buzzer_system.html"><strong>Lesson 14 Quiz Buzzer System</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_15_ne555_timer.html"><strong>Lesson 15 NE555 Timer</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_16_servo.html"><strong>Lesson 16 Servo</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_17_lcd1602.html"><strong>Lesson 17 LCD1602</strong></a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#"><strong>Lesson 18 Driving LEDs by 74HC595</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_19_7-segment.html"><strong>Lesson 19 7-segment</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="lesson_20_traffic_Light.html"><strong>Lesson 20 Traffic Light</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="for_arduino_user.html">For Arduino User</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="lesson_1_install_and_introduce_arduino_ide.html"><strong>Lesson 1 Install and Introduce Arduino IDE</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_2_blinking_led.html"><strong>Lesson 2 Blinking LED</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_3_controlling_led_by_button.html"><strong>Lesson 3 Controlling LED by Button</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_4_controlling_an_led_by_potentiometer.html"><strong>Lesson 4 Controlling an LED by Potentiometer</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_5_doorbell.html"><strong>Lesson 5 Doorbell</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_6_Photoresistor.html"><strong>Lesson 6 Photoresistor</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_7_rgb_led.html"><strong>Lesson 7 RGB LED</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_8_tilt_switch.html"><strong>Lesson 8 Tilt Switch</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_9_slide_switch.html"><strong>Lesson 9 Slide Switch</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_10_relay.html"><strong>Lesson 10 Relay</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_11_4n35.html"><strong>Lesson 11 4N35</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_12_ne555_timer.html"><strong>Lesson 12 NE555 Timer</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_13_servo.html"><strong>Lesson 13 Servo</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_14_lcd1602.html"><strong>Lesson 14 LCD1602</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_15_thermistor.html"><strong>Lesson 15 Thermistor</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_16_voltmeter.html"><strong>Lesson 16 Voltmeter</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_17_automatically_tracking_light_source.html"><strong>Lesson 17 Automatically Tracking Light Source</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_18_light_alarm.html"><strong>Lesson 18 Light Alarm</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_19_answer_machine.html"><strong>Lesson 19 Answer Machine</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_20_controlling_voice_by_light.html"><strong>Lesson 20 Controlling Voice by Light</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="lesson_21_74HC595.html"><strong>Lesson 21 74HC595</strong></a></li>
</ul>
</li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div class="section" id="lesson-18-driving-leds-by-74hc595">
<h1><strong>Lesson 18 Driving LEDs by 74HC595</strong><a class="headerlink" href="#lesson-18-driving-leds-by-74hc595" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2><strong>Introduction</strong><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>In this lesson, we will learn how to use 74HC595 to make eight LEDs
blink regularly. Now let’s get started!</p>
</div>
<div class="section" id="newly-added-components">
<h2><strong>Newly Added Components</strong><a class="headerlink" href="#newly-added-components" title="Permalink to this headline">¶</a></h2>
<a class="reference internal image-reference" href="_images/image244.png"><img alt="_images/image244.png" class="align-center" src="_images/image244.png" style="width: 800px;"/></a>
</div>
<div class="section" id="principle">
<h2><strong>Principle</strong><a class="headerlink" href="#principle" title="Permalink to this headline">¶</a></h2>
<p><strong>74HC595</strong></p>
<p>The 74HC595 consists of an 8−bit shift register and a storage register
with three−state parallel outputs. It converts serial input into
parallel output so you can save IO ports of an MCU.</p>
<p>When MR (pin10) is high level and OE (pin13) is low level, data is input
in the rising edge of SHcp and goes to the memory register through the
rising edge of SHcp. If the two clocks are connected together, the shift
register is always one pulse earlier than the memory register. There is
a serial shift input pin (Ds), a serial output pin (Q) and an
asynchronous reset button (low level) in the memory register. The memory
register outputs a Bus with a parallel 8-bit and in three states. When
OE is enabled (low level), the data in memory register is output to the
bus.</p>
<a class="reference internal image-reference" href="_images/image181.png"><img alt="_images/image181.png" class="align-center" src="_images/image181.png" style="width: 800px;"/></a>
<p><strong>Pins of 74HC595 and their Functions:</strong></p>
<p><strong>Q0-Q7</strong>: 8-bit parallel data output pins, able to control 8 LEDs or 8
pins of 7-Segment Display directly.</p>
<p><strong>Q7’</strong>: Series output pin, connected to DS of another 74HC595 to
connect multiple 74HC595s in series.</p>
<p><strong>MR</strong>: Reset pin, active at low level;</p>
<p><strong>SHcp</strong>: Time sequence input of shift register. On the rising edge, the
data in shift register moves successively one bit, i.e. data in Q1 moves
to Q2, and so forth. While on the falling edge, the data in shift
register remain unchanged.</p>
<p><strong>STcp</strong>: Time sequence input of storage register. On the rising edge,
data in the shift register moves into memory register.</p>
<p><strong>OE</strong>: Output enable pin, active at low level.</p>
<p><strong>DS</strong>: Serial data input pin.</p>
<p><strong>VCC</strong>: Positive supply voltage.</p>
<p><strong>GND</strong>: Ground.</p>
</div>
<div class="section" id="schematic-diagram">
<h2><strong>Schematic Diagram</strong><a class="headerlink" href="#schematic-diagram" title="Permalink to this headline">¶</a></h2>
<p>In the experiment <strong>MR</strong> is connected to <strong>3.3V</strong> (HIGH Level) and
<strong>OE</strong> to <strong>GND</strong> (LOW Level). Therefore, the data is input into the
rising edge of <strong>SHcp</strong> and enters the memory register through the
rising edge. In the rising edge of the <strong>SHcp</strong>, the data in the shift
register moves successively one bit in one time, i.e. data in <strong>Q1</strong>
moves to <strong>Q2</strong>, and so forth. In the rising edge of <strong>STcp</strong>, data in
the shift register moves into the memory register. All data will be
moved to the memory register 8 times. Then the data in the memory
register is output to the bus (<strong>Q0-Q7</strong>).</p>
<a class="reference internal image-reference" href="_images/image245.png"><img alt="_images/image245.png" class="align-center" src="_images/image245.png" style="width: 800px;"/></a>
<a class="reference internal image-reference" href="_images/image260.png"><img alt="_images/image260.png" class="align-center" src="_images/image260.png" style="width: 800px;"/></a>
</div>
<div class="section" id="build-the-circuit">
<h2><strong>Build the Circuit</strong><a class="headerlink" href="#build-the-circuit" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Recognize the direction of the chip according to the concave on
it.</p>
</div>
<a class="reference internal image-reference" href="_images/image246.png"><img alt="_images/image246.png" class="align-center" src="_images/image246.png" style="width: 800px;"/></a>
</div>
<div class="section" id="for-c-language-users">
<h2><strong>For C Language Users</strong><a class="headerlink" href="#for-c-language-users" title="Permalink to this headline">¶</a></h2>
<div class="section" id="command">
<h3><strong>Command</strong><a class="headerlink" href="#command" title="Permalink to this headline">¶</a></h3>
<p><strong>1.</strong> Go to the folder of the code.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">pi</span><span class="o">/</span><span class="n">electronic</span><span class="o">-</span><span class="n">kit</span><span class="o">/</span><span class="k">for</span><span class="o">-</span><span class="n">raspberry</span><span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Lesson_18_Driving_Leds_by_74hc595</span>
</pre></div>
</div>
<p><strong>2.</strong> Compile the code.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gcc</span> <span class="mi">18_74</span><span class="n">hc595</span><span class="o">.</span><span class="n">c</span> <span class="o">-</span><span class="n">lwiringPi</span>
</pre></div>
</div>
<p><strong>3.</strong> Run the executable file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">./</span><span class="n">a</span><span class="o">.</span><span class="n">out</span>
</pre></div>
</div>
<p>As the code runs, you can see these eight LEDs are lit up from left to
right, and then all LEDs light up and flash 3 times. After that, these
eight LEDs are lit from right to left, then they all turn on before
flashing 3 times. This loop continues in this way.</p>
</div>
<div class="section" id="code">
<h3><strong>Code</strong><a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span><span class="c1">#include &lt;wiringPi.h&gt;</span>
<span class="mf">2.</span><span class="c1">#include &lt;stdio.h&gt;</span>
<span class="mf">3.</span>
<span class="mf">4.</span><span class="c1">#define   SDI   0   //serial data input</span>
<span class="mf">5.</span><span class="c1">#define   RCLK  1   //memory clock input(STCP)</span>
<span class="mf">6.</span><span class="c1">#define   SRCLK 2   //shift register clock input(SHCP)</span>
<span class="mf">7.</span>
<span class="mf">8.</span><span class="n">unsigned</span> <span class="n">char</span> <span class="n">LED</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0x04</span><span class="p">,</span><span class="mh">0x08</span><span class="p">,</span><span class="mh">0x10</span><span class="p">,</span><span class="mh">0x20</span><span class="p">,</span><span class="mh">0x40</span><span class="p">,</span><span class="mh">0x80</span><span class="p">};</span>
<span class="mf">9.</span>
<span class="mf">10.</span><span class="n">void</span> <span class="n">pulse</span><span class="p">(</span><span class="nb">int</span> <span class="n">pin</span><span class="p">){</span>
<span class="mf">11.</span>    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="mf">12.</span>    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="mf">13.</span><span class="p">}</span>
<span class="mf">14.</span>
<span class="mf">15.</span><span class="n">void</span> <span class="n">SIPO</span><span class="p">(</span><span class="n">unsigned</span> <span class="n">char</span> <span class="n">byte</span><span class="p">){</span>
<span class="mf">16.</span>    <span class="nb">int</span> <span class="n">i</span><span class="p">;</span>
<span class="mf">17.</span>    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">8</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="mf">18.</span>        <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SDI</span><span class="p">,</span> <span class="p">((</span><span class="n">byte</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x80</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">));</span>
<span class="mf">19.</span>        <span class="n">pulse</span><span class="p">(</span><span class="n">SRCLK</span><span class="p">);</span>
<span class="mf">20.</span>    <span class="p">}</span>
<span class="mf">21.</span><span class="p">}</span>
<span class="mf">22.</span>
<span class="mf">23.</span><span class="n">void</span> <span class="n">init</span><span class="p">(</span><span class="n">void</span><span class="p">){</span>
<span class="mf">24.</span>    <span class="n">pinMode</span><span class="p">(</span><span class="n">SDI</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="mf">25.</span>    <span class="n">pinMode</span><span class="p">(</span><span class="n">RCLK</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="mf">26.</span>    <span class="n">pinMode</span><span class="p">(</span><span class="n">SRCLK</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="mf">27.</span>
<span class="mf">28.</span>    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SDI</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="mf">29.</span>    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">RCLK</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="mf">30.</span>    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SRCLK</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="mf">31.</span><span class="p">}</span>
<span class="mf">32.</span>
<span class="mf">33.</span><span class="n">int</span> <span class="n">main</span><span class="p">(</span><span class="n">void</span><span class="p">){</span>
<span class="mf">34.</span>    <span class="nb">int</span> <span class="n">i</span><span class="p">;</span>
<span class="mf">35.</span>
<span class="mf">36.</span>    <span class="k">if</span><span class="p">(</span><span class="n">wiringPiSetup</span><span class="p">()</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">){</span> <span class="o">//</span><span class="n">when</span> <span class="n">initialize</span> <span class="n">wiring</span> <span class="n">failed</span><span class="p">,</span> <span class="nb">print</span> <span class="n">message</span> <span class="n">to</span> <span class="n">screen</span>
<span class="mf">37.</span>        <span class="n">printf</span><span class="p">(</span><span class="s2">"setup wiringPi failed !"</span><span class="p">);</span>
<span class="mf">38.</span>        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="mf">39.</span>    <span class="p">}</span>
<span class="mf">40.</span>
<span class="mf">41.</span>    <span class="n">init</span><span class="p">();</span>
<span class="mf">42.</span>
<span class="mf">43.</span>    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){</span>
<span class="mf">44.</span>        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">8</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="mf">45.</span>            <span class="n">SIPO</span><span class="p">(</span><span class="n">LED</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="mf">46.</span>            <span class="n">pulse</span><span class="p">(</span><span class="n">RCLK</span><span class="p">);</span>
<span class="mf">47.</span>            <span class="n">delay</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>
<span class="mf">48.</span>        <span class="p">}</span>
<span class="mf">49.</span>        <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
<span class="mf">50.</span>
<span class="mf">51.</span>        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="mf">52.</span>            <span class="n">SIPO</span><span class="p">(</span><span class="mh">0xff</span><span class="p">);</span>
<span class="mf">53.</span>            <span class="n">pulse</span><span class="p">(</span><span class="n">RCLK</span><span class="p">);</span>
<span class="mf">54.</span>            <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="mf">55.</span>            <span class="n">SIPO</span><span class="p">(</span><span class="mh">0x00</span><span class="p">);</span>
<span class="mf">56.</span>            <span class="n">pulse</span><span class="p">(</span><span class="n">RCLK</span><span class="p">);</span>
<span class="mf">57.</span>            <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="mf">58.</span>        <span class="p">}</span>
<span class="mf">59.</span>        <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
<span class="mf">60.</span>
<span class="mf">61.</span>        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">8</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="mf">62.</span>            <span class="n">SIPO</span><span class="p">(</span><span class="n">LED</span><span class="p">[</span><span class="mi">8</span><span class="o">-</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
<span class="mf">63.</span>            <span class="n">pulse</span><span class="p">(</span><span class="n">RCLK</span><span class="p">);</span>
<span class="mf">64.</span>            <span class="n">delay</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>
<span class="mf">65.</span>        <span class="p">}</span>
<span class="mf">66.</span>        <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
<span class="mf">67.</span>
<span class="mf">68.</span>        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="mf">69.</span>            <span class="n">SIPO</span><span class="p">(</span><span class="mh">0xff</span><span class="p">);</span>
<span class="mf">70.</span>            <span class="n">pulse</span><span class="p">(</span><span class="n">RCLK</span><span class="p">);</span>
<span class="mf">71.</span>            <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="mf">72.</span>            <span class="n">SIPO</span><span class="p">(</span><span class="mh">0x00</span><span class="p">);</span>
<span class="mf">73.</span>            <span class="n">pulse</span><span class="p">(</span><span class="n">RCLK</span><span class="p">);</span>
<span class="mf">74.</span>            <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="mf">75.</span>        <span class="p">}</span>
<span class="mf">76.</span>        <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
<span class="mf">77.</span>    <span class="p">}</span>
<span class="mf">78.</span>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="mf">79.</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="code-explanation">
<h3><strong>Code Explanation</strong><a class="headerlink" href="#code-explanation" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">10.</span><span class="n">void</span> <span class="n">pulse</span><span class="p">(</span><span class="nb">int</span> <span class="n">pin</span><span class="p">){</span>
<span class="mf">11.</span>    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="mf">12.</span>    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="mf">13.</span><span class="p">}</span>
<span class="n">Define</span> <span class="n">an</span> <span class="n">pulse</span> <span class="n">function</span> <span class="n">to</span> <span class="n">generate</span> <span class="n">an</span> <span class="n">pulse</span><span class="o">.</span>
<span class="mf">15.</span><span class="n">void</span> <span class="n">SIPO</span><span class="p">(</span><span class="n">unsigned</span> <span class="n">char</span> <span class="n">byte</span><span class="p">){</span>
<span class="mf">16.</span>    <span class="nb">int</span> <span class="n">i</span><span class="p">;</span>
<span class="mf">17.</span>    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">8</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="mf">18.</span>        <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SDI</span><span class="p">,</span> <span class="p">((</span><span class="n">byte</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x80</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">));</span>
<span class="mf">19.</span>        <span class="n">pulse</span><span class="p">(</span><span class="n">SRCLK</span><span class="p">);</span>
<span class="mf">20.</span>    <span class="p">}</span>
<span class="mf">21.</span><span class="p">}</span>
</pre></div>
</div>
<p>The function SIPO is used to assign the byte data to SDI(DS) by bits.</p>
<p>Among them, the inequality in statement digitalWrite()((byte &amp; (0x80&gt;&gt;i))&gt;0)
is used to confirm each value written into the register and it realizes
the function by Shift operator (&gt;&gt;).</p>
<p>For example, if byte=0x01:</p>
<p>When the condition “i=0” is met, 0x80(1000 0000)&gt;&gt;0 becomes 0x80(1000 0000),
if byte&amp;0x80=0, the inequality is false, and output 0 (false).</p>
<p>If “i=1” is true, 0x80&gt;&gt;1 changes into 0x40(0100 0000); when byte&amp;0x40=0, output 0.</p>
<p>Deduce the rest from this, when and only when “i=8” is met, 0x80&gt;&gt;8 is 0x01(0000 0001),
byte&amp;0x01=1, and output 1(true).</p>
<p>Pulse(SRCLK) generates a rising edge pulse on input pin of shift register to shift
the 8 bit data on SDI to shift register successively.</p>
<p>In a word, this for loop produces 8 times to shift the 8
bits of 0000 0001 to shift register.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">23.</span><span class="n">void</span> <span class="n">init</span><span class="p">(</span><span class="n">void</span><span class="p">){</span>
<span class="mf">24.</span>    <span class="n">pinMode</span><span class="p">(</span><span class="n">SDI</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="mf">25.</span>    <span class="n">pinMode</span><span class="p">(</span><span class="n">RCLK</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="mf">26.</span>    <span class="n">pinMode</span><span class="p">(</span><span class="n">SRCLK</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="mf">27.</span>
<span class="mf">28.</span>    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SDI</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="mf">29.</span>    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">RCLK</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="mf">30.</span>    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SRCLK</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="mf">31.</span><span class="p">}</span>
</pre></div>
</div>
<p>Initialize pins. Set all control pins of 74HC595 to output mode and
initialize them to low level. At the same time, the LEDs are set to
output mode, default low level.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">44.</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">8</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="mf">45.</span>            <span class="n">SIPO</span><span class="p">(</span><span class="n">LED</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="mf">46.</span>            <span class="n">pulse</span><span class="p">(</span><span class="n">RCLK</span><span class="p">);</span>
<span class="mf">47.</span>            <span class="n">delay</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>
<span class="mf">48.</span><span class="p">}</span>
</pre></div>
</div>
<p>Use the for loop to count 8 times in cycle,
and write a 1-bit data to the SDI each time.</p>
<p>When i=0, LED[0]=0x01(0000 0001), through the function SIPO(LED[0]),
shifts the 8 bits of 0x01 to shift register successively. Pulse(SRCLK)
generates a rising edge signal on input pin of storage register to shift
the 0x01 on shift register to storage register at once. Then the data
in the memory register are output to the bus (Q7-Q0), so you’ll see the
LED on Q0 is lit up. After loops, output all eight elements in the array
LED[i] to the bus (Q7-Q0), and you’ll see eight LEDs turning on from left to right.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">51.</span>        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="mf">52.</span>            <span class="n">SIPO</span><span class="p">(</span><span class="mh">0xff</span><span class="p">);</span>
<span class="mf">53.</span>            <span class="n">pulse</span><span class="p">(</span><span class="n">RCLK</span><span class="p">);</span>
<span class="mf">54.</span>            <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="mf">55.</span>            <span class="n">SIPO</span><span class="p">(</span><span class="mh">0x00</span><span class="p">);</span>
<span class="mf">56.</span>            <span class="n">pulse</span><span class="p">(</span><span class="n">RCLK</span><span class="p">);</span>
<span class="mf">57.</span>            <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="mf">58.</span> <span class="p">}</span>
</pre></div>
</div>
<p>In this part, the for loop is used to three times repeat the program in for()
statement. SIPO(0xff) means 8 LEDs are lit up, SIPO(0x00) represents 8 LEDs turn
off. That is, let 8 LEDs turn off 3 times simultaneously.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">61.</span>        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">8</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="mf">62.</span>            <span class="n">SIPO</span><span class="p">(</span><span class="n">LED</span><span class="p">[</span><span class="mi">8</span><span class="o">-</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
<span class="mf">63.</span>            <span class="n">pulse</span><span class="p">(</span><span class="n">RCLK</span><span class="p">);</span>
<span class="mf">64.</span>            <span class="n">delay</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>
<span class="mf">65.</span>        <span class="p">}</span>
</pre></div>
</div>
<p>By the same token, this for loop allows 8 LEDs be
lit up one by one in reverse order. Here, i gradually
increases from 0, and 8-i-1 gradually decreases. SIPO(LED[8-i-1])
can be used to call the data in the LED[] array from back to front
so that you can get 8 LEDs lit up one by one in reverse order.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">68.</span>        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="mf">69.</span>            <span class="n">SIPO</span><span class="p">(</span><span class="mh">0xff</span><span class="p">);</span>
<span class="mf">70.</span>            <span class="n">pulse</span><span class="p">(</span><span class="n">RCLK</span><span class="p">);</span>
<span class="mf">71.</span>            <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="mf">72.</span>            <span class="n">SIPO</span><span class="p">(</span><span class="mh">0x00</span><span class="p">);</span>
<span class="mf">73.</span>            <span class="n">pulse</span><span class="p">(</span><span class="n">RCLK</span><span class="p">);</span>
<span class="mf">74.</span>            <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="mf">75.</span>        <span class="p">}</span>
</pre></div>
</div>
<p>Then, make the eight LEDs turn on or off 3 times simultaneously.</p>
</div>
</div>
<div class="section" id="for-python-language-users">
<h2><strong>For Python Language Users</strong><a class="headerlink" href="#for-python-language-users" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3><strong>Command</strong><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p><strong>1.</strong> Go to the folder of the code.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">pi</span><span class="o">/</span><span class="n">electronic</span><span class="o">-</span><span class="n">kit</span><span class="o">/</span><span class="k">for</span><span class="o">-</span><span class="n">raspberry</span><span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="n">python</span>
</pre></div>
</div>
<p><strong>2.</strong> Run the code.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">python3</span> <span class="mi">18_74</span><span class="n">HC595</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>As the code runs, you can see these eight LEDs are lit up from left to
right, and then all LEDs light up and flash 3 times. After that, these
eight LEDs are lit from right to left, then they all turn on before
flashing 3 times. This loop continues in this way.</p>
</div>
<div class="section" id="id2">
<h3><strong>Code</strong><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span><span class="kn">import</span> <span class="nn">RPi.GPIO</span> <span class="k">as</span> <span class="nn">GPIO</span>
<span class="mf">2.</span><span class="kn">import</span> <span class="nn">time</span>
<span class="mf">3.</span>
<span class="mf">4.</span><span class="n">SDI</span>   <span class="o">=</span> <span class="mi">17</span>
<span class="mf">5.</span><span class="n">RCLK</span>  <span class="o">=</span> <span class="mi">18</span>
<span class="mf">6.</span><span class="n">SRCLK</span> <span class="o">=</span> <span class="mi">27</span>
<span class="mf">7.</span>
<span class="mf">8.</span><span class="n">LED0</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0x04</span><span class="p">,</span><span class="mh">0x08</span><span class="p">,</span><span class="mh">0x10</span><span class="p">,</span><span class="mh">0x20</span><span class="p">,</span><span class="mh">0x40</span><span class="p">,</span><span class="mh">0x80</span><span class="p">]</span>    <span class="c1">#original mode</span>
<span class="mf">9.</span><span class="n">BLINK</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0x00</span><span class="p">]</span>         <span class="c1">#blink</span>
<span class="mf">10.</span>
<span class="mf">11.</span><span class="k">def</span> <span class="nf">setup</span><span class="p">():</span>
<span class="mf">12.</span>    <span class="n">GPIO</span><span class="o">.</span><span class="n">setmode</span><span class="p">(</span><span class="n">GPIO</span><span class="o">.</span><span class="n">BCM</span><span class="p">)</span>
<span class="mf">13.</span>    <span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">SDI</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">OUT</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="n">GPIO</span><span class="o">.</span><span class="n">LOW</span><span class="p">)</span>
<span class="mf">14.</span>    <span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">RCLK</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">OUT</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="n">GPIO</span><span class="o">.</span><span class="n">LOW</span><span class="p">)</span>
<span class="mf">15.</span>    <span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">SRCLK</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">OUT</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="n">GPIO</span><span class="o">.</span><span class="n">LOW</span><span class="p">)</span>
<span class="mf">16.</span>
<span class="mf">17.</span><span class="c1"># Shift the data to 74HC595</span>
<span class="mf">18.</span><span class="k">def</span> <span class="nf">hc595_shift</span><span class="p">(</span><span class="n">dat</span><span class="p">):</span>
<span class="mf">19.</span>    <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
<span class="mf">20.</span>        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">SDI</span><span class="p">,</span> <span class="mh">0x80</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dat</span> <span class="o">&lt;&lt;</span> <span class="n">bit</span><span class="p">))</span>
<span class="mf">21.</span>        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">SRCLK</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>
<span class="mf">22.</span>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
<span class="mf">23.</span>        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">SRCLK</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">LOW</span><span class="p">)</span>
<span class="mf">24.</span>    <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">RCLK</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>
<span class="mf">25.</span>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
<span class="mf">26.</span>    <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">RCLK</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">LOW</span><span class="p">)</span>
<span class="mf">27.</span>
<span class="mf">28.</span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="mf">29.</span>    <span class="n">print_message</span><span class="p">()</span>
<span class="mf">30.</span>    <span class="n">mode</span> <span class="o">=</span> <span class="n">LED0</span>
<span class="mf">31.</span>    <span class="n">sleeptime</span> <span class="o">=</span> <span class="mf">0.15</span>
<span class="mf">32.</span>    <span class="n">blink_sleeptime</span> <span class="o">=</span> <span class="mf">0.15</span>
<span class="mf">33.</span>
<span class="mf">34.</span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="mf">35.</span>        <span class="c1"># Change LED status from mode</span>
<span class="mf">36.</span>        <span class="k">for</span> <span class="n">onoff</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
<span class="mf">37.</span>            <span class="n">hc595_shift</span><span class="p">(</span><span class="n">onoff</span><span class="p">)</span>
<span class="mf">38.</span>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleeptime</span><span class="p">)</span>
<span class="mf">39.</span>
<span class="mf">40.</span>        <span class="k">for</span> <span class="n">onoff</span> <span class="ow">in</span> <span class="n">BLINK</span><span class="p">:</span>
<span class="mf">41.</span>            <span class="n">hc595_shift</span><span class="p">(</span><span class="n">onoff</span><span class="p">)</span>
<span class="mf">42.</span>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">blink_sleeptime</span><span class="p">)</span>
<span class="mf">43.</span>
<span class="mf">44.</span>        <span class="c1"># Change LED status from mode reverse</span>
<span class="mf">45.</span>        <span class="k">for</span> <span class="n">onoff</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">mode</span><span class="p">):</span>
<span class="mf">46.</span>            <span class="n">hc595_shift</span><span class="p">(</span><span class="n">onoff</span><span class="p">)</span>
<span class="mf">47.</span>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleeptime</span><span class="p">)</span>
<span class="mf">48.</span>
<span class="mf">49.</span>        <span class="k">for</span> <span class="n">onoff</span> <span class="ow">in</span> <span class="n">BLINK</span><span class="p">:</span>
<span class="mf">50.</span>            <span class="n">hc595_shift</span><span class="p">(</span><span class="n">onoff</span><span class="p">)</span>
<span class="mf">51.</span>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">blink_sleeptime</span><span class="p">)</span>
<span class="mf">52.</span>
<span class="mf">53.</span><span class="k">def</span> <span class="nf">destroy</span><span class="p">():</span>
<span class="mf">54.</span>    <span class="n">GPIO</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
<span class="mf">55.</span>
<span class="mf">56.</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
<span class="mf">57.</span>    <span class="n">setup</span><span class="p">()</span>
<span class="mf">58.</span>    <span class="k">try</span><span class="p">:</span>
<span class="mf">59.</span>        <span class="n">main</span><span class="p">()</span>
<span class="mf">60.</span>    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
<span class="mf">61.</span>        <span class="n">destroy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3><strong>Code Explanation</strong><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">8.</span><span class="n">LED0</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0x04</span><span class="p">,</span><span class="mh">0x08</span><span class="p">,</span><span class="mh">0x10</span><span class="p">,</span><span class="mh">0x20</span><span class="p">,</span><span class="mh">0x40</span><span class="p">,</span><span class="mh">0x80</span><span class="p">]</span>    <span class="c1">#original mode</span>
</pre></div>
</div>
<p>Use array to define LED flashing mode, you can also customize
several hexadecimals to light up 8 LEDs.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">11.</span><span class="k">def</span> <span class="nf">setup</span><span class="p">():</span>
<span class="mf">12.</span>    <span class="n">GPIO</span><span class="o">.</span><span class="n">setmode</span><span class="p">(</span><span class="n">GPIO</span><span class="o">.</span><span class="n">BCM</span><span class="p">)</span>    <span class="c1"># Number GPIOs by its BCM location</span>
<span class="mf">13.</span>    <span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">SDI</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">OUT</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="n">GPIO</span><span class="o">.</span><span class="n">LOW</span><span class="p">)</span>
<span class="mf">14.</span>    <span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">RCLK</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">OUT</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="n">GPIO</span><span class="o">.</span><span class="n">LOW</span><span class="p">)</span>
<span class="mf">15.</span>    <span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">SRCLK</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">OUT</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="n">GPIO</span><span class="o">.</span><span class="n">LOW</span><span class="p">)</span>
</pre></div>
</div>
<p>Initialize pins. Set all control pins of 74HC595 to output mode
and initialize them to low level. At the same time, the LED
lights are set to output mode, default low level.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">18.</span><span class="k">def</span> <span class="nf">hc595_shift</span><span class="p">(</span><span class="n">dat</span><span class="p">):</span>
</pre></div>
</div>
<p>Define a function hc595_shift() to output the 8 bits of dat to Q0-Q7.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">19.</span> <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
<span class="mf">20.</span>        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">SDI</span><span class="p">,</span> <span class="mh">0x80</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dat</span> <span class="o">&lt;&lt;</span> <span class="n">bit</span><span class="p">))</span>
<span class="mf">21.</span>        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">SRCLK</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>
<span class="mf">22.</span>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
<span class="mf">23.</span>                  <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">SRCLK</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">LOW</span><span class="p">)</span>
</pre></div>
</div>
<p>Assign the dat to SDI(DS) according to bits. Pin SRCLK will convert from
low to high, and generate a rising edge pulse, then shift the data in
pin SDI to shift register. Execute the loop 8 times to shift the 8 bits
of dat to the shift register in proper order.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">24.</span>    <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">RCLK</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>
<span class="mf">25.</span>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
<span class="mf">26.</span>    <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">RCLK</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">LOW</span><span class="p">)</span>
</pre></div>
</div>
<p>Pin RCLK converts from low to high and generate a rising edge,
then shift data from shift register to storage register.
Finally the data in the memory register is output to the bus (Q0-Q7).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">36.</span>        <span class="k">for</span> <span class="n">onoff</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
<span class="mf">37.</span>            <span class="n">hc595_shift</span><span class="p">(</span><span class="n">onoff</span><span class="p">)</span>
<span class="mf">38.</span>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleeptime</span><span class="p">)</span>
</pre></div>
</div>
<p>Here we use a onoff variable to control the LED that changes
within the range of mode, and hc595_shift (onoff) means
lighting up LED one by one. For example, when mode is the
first datum in LED0, or 0x01, onoff = mode = 0x01 = 00000001.
In this course, the LED is lit by high level. To put it another
way, it is Hc595_shift (onoff) = hc595_shift (00000001) that
lights up the last LED. Along the same vein, when the value of mode
is the second datum of LED0 (onoff = 0x02 = 00000010), the second
last LED turns on.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">45.</span>        <span class="k">for</span> <span class="n">onoff</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">mode</span><span class="p">):</span>
<span class="mf">46.</span>            <span class="n">hc595_shift</span><span class="p">(</span><span class="n">onoff</span><span class="p">)</span>
<span class="mf">47.</span>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleeptime</span><span class="p">)</span>
</pre></div>
</div>
<p>According to the same principle, a reversed is used here
to get LEDs lit up in reverse order.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">49.</span>        <span class="k">for</span> <span class="n">onoff</span> <span class="ow">in</span> <span class="n">BLINK</span><span class="p">:</span>
<span class="mf">50.</span>            <span class="n">hc595_shift</span><span class="p">(</span><span class="n">onoff</span><span class="p">)</span>
<span class="mf">51.</span>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">blink_sleeptime</span><span class="p">)</span>
</pre></div>
</div>
<p>In the same way, light up 8 LEDs; exactly, 8 LEDs are turned
on or off 3 times synchronously in the same pattern as
that of the LEDs in the BLINK array.</p>
</div>
</div>
<div class="section" id="phenomenon-picture">
<h2><strong>Phenomenon Picture</strong><a class="headerlink" href="#phenomenon-picture" title="Permalink to this headline">¶</a></h2>
<a class="reference internal image-reference" href="_images/image184.jpeg"><img alt="_images/image184.jpeg" class="align-center" src="_images/image184.jpeg" style="width: 600px;"/></a>
</div>
</div>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="lesson_19_7-segment.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title"><strong>Lesson 19 7-segment</strong></div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="lesson_17_lcd1602.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title"><strong>Lesson 17 LCD1602</strong></div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2021, sunfounder
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="_sources/lesson_18_driving_leds_by_74hc595.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#"><strong>Lesson 18 Driving LEDs by 74HC595</strong></a><ul>
<li><a class="reference internal" href="#introduction"><strong>Introduction</strong></a></li>
<li><a class="reference internal" href="#newly-added-components"><strong>Newly Added Components</strong></a></li>
<li><a class="reference internal" href="#principle"><strong>Principle</strong></a></li>
<li><a class="reference internal" href="#schematic-diagram"><strong>Schematic Diagram</strong></a></li>
<li><a class="reference internal" href="#build-the-circuit"><strong>Build the Circuit</strong></a></li>
<li><a class="reference internal" href="#for-c-language-users"><strong>For C Language Users</strong></a><ul>
<li><a class="reference internal" href="#command"><strong>Command</strong></a></li>
<li><a class="reference internal" href="#code"><strong>Code</strong></a></li>
<li><a class="reference internal" href="#code-explanation"><strong>Code Explanation</strong></a></li>
</ul>
</li>
<li><a class="reference internal" href="#for-python-language-users"><strong>For Python Language Users</strong></a><ul>
<li><a class="reference internal" href="#id1"><strong>Command</strong></a></li>
<li><a class="reference internal" href="#id2"><strong>Code</strong></a></li>
<li><a class="reference internal" href="#id3"><strong>Code Explanation</strong></a></li>
</ul>
</li>
<li><a class="reference internal" href="#phenomenon-picture"><strong>Phenomenon Picture</strong></a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div>
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="https://ezblock.cc/readDocFile/topHead.js"></script>
    <script src="_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>